#!/bin/sh

# Block pushing tags that already exist on remote
# This prevents accidentally re-releasing the same version

while read local_ref local_sha remote_ref remote_sha; do
  if echo "$local_ref" | grep -q "^refs/tags/"; then
    tag_name="${local_ref#refs/tags/}"

    # Check if tag exists on remote
    if git ls-remote --tags origin | grep -q "refs/tags/${tag_name}$"; then
      echo "Error: Tag '${tag_name}' already exists on remote."
      echo "Delete it first with: git push origin :refs/tags/${tag_name}"
      echo "Or use a new version number."
      exit 1
    fi
  fi
done

exit 0
